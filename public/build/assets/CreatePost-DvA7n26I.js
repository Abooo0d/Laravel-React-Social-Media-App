import{j as s,R as Y,r as l,c as V,a as X,b as M}from"./app-D8ApISFC.js";import{P as q,H as G,a as I}from"./AuthenticatedLayout-BWu7Fzt5.js";import{P as W,a as J,I as K}from"./PostCard-CKV49jer.js";import{S as z,P as T}from"./Buttons-D6eagE2q.js";import{S as Q}from"./Spinner-WIpfGoCI.js";const Z=({post:r,attachmentsErrors:h,onDelete:m,setImage:f,setShowImage:x,setShowPost:b,setImageIndex:j})=>s.jsx("div",{children:r.attachments&&r.attachments.length>0?s.jsx(s.Fragment,{children:s.jsx("div",{className:`w-full lg:min-h-[300px] min-h-[200px] overflow-hidden grid gap-3 mt-4
                              ${r.attachments.length===1?" grid-cols-1":r.attachments.length>=2?" grid-cols-2":""}
                            `,children:r.attachments.length>2?s.jsx(s.Fragment,{children:r.attachments.map((p,c)=>s.jsx(Y.Fragment,{children:c===0?s.jsx("div",{className:"relative",children:s.jsx(W,{attachment:p,index:c,attachmentsErrors:h,onDelete:m,setImage:f,setImageIndex:j,setShowImage:x})}):c===1&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"relative w-full h-full",children:[s.jsx(W,{attachment:p,index:c,attachmentsErrors:h,onDelete:m,setImage:f,setImageIndex:j,setShowImage:x,showActions:!1}),s.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-800/50 backdrop-blur-sm flex justify-center items-center rounded-lg cursor-pointer z-[1] group",onClick:()=>b(!0),children:s.jsxs("span",{className:"text-3xl text-gray-200 rounded-full border-[1px] border-solid border-gray-200/50 p-2 h-[60px] w-[60px] flex justify-center items-center group-hover:bg-gray-800/20 duration-200 group-hover:scale-105",children:["+",r.attachments.length-2]})},c+"div")]},c)})},c))}):s.jsx(s.Fragment,{children:r.attachments.map((p,c)=>s.jsx("div",{className:"relative",children:s.jsx(W,{attachment:p,index:c,attachmentsErrors:h,onDelete:m,setImage:f,setImageIndex:j,setShowImage:x})},c))})})}):s.jsx(s.Fragment,{})}),ee=({showForm:r,setShowForm:h,groupId:m="",refetch:f})=>{const[x,b]=l.useState(""),[j,p]=l.useState(""),[c,_]=l.useState(!1),[se,te]=l.useState(!1),[H,N]=l.useState(),[A,y]=l.useState([]),[L,v]=l.useState(!1),{user:C}=V(),[F,S]=l.useState([]),{setErrors:w,setSuccessMessage:$}=X(),E=l.useRef(),[i,P]=l.useState({body:"",attachments:[],user_id:C.id,group_id:m||""});function B(){h(!1)}const R=()=>{const t=E.current;t&&(t.style.height="80px",t.style.height=`${t.scrollHeight}px`)},D=()=>{try{if(i.body!==""||i.attachments.length!==0){const t=new FormData;t.append("body",i.body),t.append("user_id",i.user_id),t.append("group_id",i.group_id),F.map(a=>a.file).forEach(a=>{t.append("attachments[]",a)}),M.post(route("post.create"),t).then(a=>{var n;h(!1),f(),$((n=a==null?void 0:a.data)==null?void 0:n.success)}).catch(a=>{var n,g;w([((g=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:g.message)||"Some Thing Went Wrong"]),y([]);for(const o in e)y(d=>[...d,{index:o.split(".")[1],message:e[o]}])})}}catch(t){console.log(t)}},O=async t=>{const a=[...t.target.files].map(n=>({file:n,url:URL.createObjectURL(n)}));S(n=>[...n,...a])},k=(t,u,a)=>{var n,g;try{t.file?(S(o=>o.filter(d=>d.file!==t.file)),y(o=>o.filter(d=>d.index!=u))):(S(o=>o.map(d=>({...d,isDeleted:d==t||d.isDeleted==!0}))),y(o=>o.filter(d=>d.index!=u)))}catch(o){w([((g=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:g.message)||"Some Thing Went Wrong"])}},U=()=>{var t,u;if(i.body!=""){v(!0);try{M.post(route("post.aiPost"),{message:i.body}).then(({data:a})=>{P({...i,body:a.message}),v(!1)}).catch(a=>{var n,g;w([((g=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:g.message)||"Some Thing Went Wrong"]),v(!1)})}catch(a){w([((u=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:u.message)||"Some Thing Went Wrong"]),v(!1)}}};return l.useEffect(()=>{P({body:"",attachments:[],user_id:C.id,group_id:m}),S([]),y([]),R()},[r]),l.useEffect(()=>{R()},[i]),l.useEffect(()=>{P(t=>({...t,attachments:F}))},[F]),s.jsxs("div",{className:`relative z-10 focus:outline-none delay-200 ${r?"visible ":"invisible"}`,children:[s.jsxs(q,{showForm:r,children:[s.jsx(z,{event:B,classes:"absolute top-[20px] right-[20px] py-1.5 px-3",children:s.jsx(G,{className:"w-5 h-5 text-gray-200"})}),s.jsx("div",{as:"h3",className:"text-base/7 font-medium text-white mb-4",children:"Create Post"}),s.jsxs("div",{className:"max-h-[400px] h-fit overflow-auto",children:[s.jsxs("div",{className:"relative",children:[s.jsx(T,{classes:"absolute top-[10px] right-[10px] z-[100] flex justify-center items-center w-[35px] h-[35px] text-gray-400",event:U,children:L?s.jsx(Q,{size:"small "}):s.jsx(I,{className:" w-[20px] h-[20px]"})}),s.jsx("textarea",{className:"bg-gray-800 flex-1 w-full rounded-md outline-none border-none focus:outline-none focus:border-none ring-0 focus:ring-0 text-gray-300 resize-none h-auto min-h-[40px] max-h-[150px] ",ref:E,name:"message",value:i.body,placeholder:"What On You Mind",onChange:t=>{P(u=>({...u,body:t.target.value}))}})]}),s.jsx(Z,{post:i,attachmentsErrors:A,onDelete:k,setImage:b,setShowImage:p,setShowPost:_,setImageIndex:N})]}),s.jsxs("div",{className:"mt-4 gap-2 flex justify-end items-center",children:[s.jsxs(z,{classes:"relative py-1.5 px-3",enabled:!0,children:["Add Files",s.jsx("input",{type:"file",name:"files",className:"absolute top-0 left-0 right-0 bottom-0 cursor-pointer opacity-0",multiple:!0,onChange:t=>{O(t)}})]}),s.jsx(T,{classes:"py-1.5 px-3",event:()=>{D()},enabled:!0,children:"Submit"})]})]}),s.jsx(J,{show:c,user:C,post:i,attachmentsErrors:A,onDelete:k,setShow:_,setImage:b,setShowImage:p,setImageIndex:N}),s.jsx(K,{image:x,show:j,imageIndex:H,post:i,setShowImage:p,setImageIndex:N,update:!1})]})},ie=({groupId:r=null,classes:h,refetch:m})=>{const[f,x]=l.useState(!1);return s.jsxs("div",{className:`max-w-[700px] w-full dark:bg-gray-900 rounded-lg lg:px-6 px-4 flex flex-col duration-500  ${h}`,children:[s.jsx("div",{className:"w-full rounded-lg bg-gray-800/50 hover:bg-gray-700/50 py-1.5 px-3 duration-200 min-h-[40px] cursor-pointer text-gray-400 hover:border-gray-600 border-[1px] border-solid border-gray-600/50",onClick:()=>x(!0),children:"What`s On Your Mind"}),s.jsx(ee,{refetch:m,showForm:f,setShowForm:x,groupId:r})]})};export{ie as C};
