import{j as s,R as Y,r as l,c as V,a as X,b as M}from"./app-DIx6L9fD.js";import{P as q,H as G,a as I}from"./AuthenticatedLayout-C5_OH66V.js";import{P as k,a as J,I as K}from"./PostCard-DMthNg9j.js";import{S as z,P as T}from"./Buttons-BYWrEsx6.js";import{S as Q}from"./Spinner-BOWdsVQC.js";const Z=({post:n,attachmentsErrors:h,onDelete:g,setImage:f,setShowImage:m,setShowPost:j,setImageIndex:y})=>s.jsx("div",{children:n.attachments&&n.attachments.length>0?s.jsx(s.Fragment,{children:s.jsx("div",{className:`w-full lg:min-h-[300px] min-h-[200px] overflow-hidden grid gap-3 mt-4
                              ${n.attachments.length===1?" grid-cols-1":n.attachments.length>=2?" grid-cols-2":""}
                            `,children:n.attachments.length>2?s.jsx(s.Fragment,{children:n.attachments.map((x,c)=>s.jsx(Y.Fragment,{children:c===0?s.jsx("div",{className:"relative",children:s.jsx(k,{attachment:x,index:c,attachmentsErrors:h,onDelete:g,setImage:f,setImageIndex:y,setShowImage:m})}):c===1&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"relative w-full h-full",children:[s.jsx(k,{attachment:x,index:c,attachmentsErrors:h,onDelete:g,setImage:f,setImageIndex:y,setShowImage:m,showActions:!1}),s.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gray-800/50 backdrop-blur-sm flex justify-center items-center rounded-lg cursor-pointer z-[1] group",onClick:()=>j(!0),children:s.jsxs("span",{className:"text-3xl text-gray-200 rounded-full border-[1px] border-solid border-gray-200/50 p-2 h-[60px] w-[60px] flex justify-center items-center group-hover:bg-gray-800/20 duration-200 group-hover:scale-105",children:["+",n.attachments.length-2]})},c+"div")]},c)})},c))}):s.jsx(s.Fragment,{children:n.attachments.map((x,c)=>s.jsx("div",{className:"relative",children:s.jsx(k,{attachment:x,index:c,attachmentsErrors:h,onDelete:g,setImage:f,setImageIndex:y,setShowImage:m})},c))})})}):s.jsx(s.Fragment,{})}),ee=({showForm:n,setShowForm:h,groupId:g="",refetch:f})=>{const[m,j]=l.useState(""),[y,x]=l.useState(""),[c,W]=l.useState(!1),[se,te]=l.useState(!1),[H,N]=l.useState(),[_,b]=l.useState([]),[L,v]=l.useState(!1),{user:C}=V(),[F,S]=l.useState([]),{setErrors:w,setSuccessMessage:$}=X(),A=l.useRef(),[i,P]=l.useState({body:"",attachments:[],user_id:C.id,group_id:g||""});function B(){h(!1)}const E=()=>{const t=A.current;t&&(t.style.height="80px",t.style.height=`${t.scrollHeight}px`)},D=()=>{try{if(i.body!==""||i.attachments.length!==0){const t=new FormData;t.append("body",i.body),t.append("user_id",i.user_id),t.append("group_id",i.group_id),F.map(a=>a.file).forEach(a=>{t.append("attachments[]",a)}),M.post(route("post.create"),t).then(a=>{var r;h(!1),f(),$((r=a==null?void 0:a.data)==null?void 0:r.success)}).catch(a=>{var r,p;w([((p=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:p.message)||"Some Thing Went Wrong"]),b([]);for(const o in e)b(d=>[...d,{index:o.split(".")[1],message:e[o]}])})}}catch(t){console.log(t)}},O=async t=>{const a=[...t.target.files].map(r=>({file:r,url:URL.createObjectURL(r)}));S(r=>[...r,...a])},R=(t,u,a)=>{var r,p;try{t.file?(S(o=>o.filter(d=>d.file!==t.file)),b(o=>o.filter(d=>d.index!=u))):(S(o=>o.map(d=>({...d,isDeleted:d==t||d.isDeleted==!0}))),b(o=>o.filter(d=>d.index!=u)))}catch(o){w([((p=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:p.message)||"Some Thing Went Wrong"])}},U=()=>{var t,u;if(i.body!=""){v(!0);try{M.post(route("post.aiPost"),{message:i.body}).then(({data:a})=>{P({...i,body:a.message}),v(!1)}).catch(a=>{var r,p;w([((p=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:p.message)||"Some Thing Went Wrong"]),v(!1)})}catch(a){w([((u=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:u.message)||"Some Thing Went Wrong"]),v(!1)}}};return l.useEffect(()=>{P({body:"",attachments:[],user_id:C.id,group_id:g}),S([]),b([]),E()},[n]),l.useEffect(()=>{E()},[i]),l.useEffect(()=>{P(t=>({...t,attachments:F}))},[F]),s.jsxs("div",{className:`relative z-10 focus:outline-none delay-200 ${n?"visible ":"invisible"}`,children:[s.jsxs(q,{showForm:n,children:[s.jsx(z,{event:B,classes:"absolute top-[20px] right-[20px] py-1.5 px-3",children:s.jsx(G,{className:"w-5 h-5 text-gray-200"})}),s.jsx("div",{as:"h3",className:"text-base/7 font-medium text-white mb-4",children:"Create Post"}),s.jsxs("div",{className:"max-h-[400px] h-fit overflow-auto",children:[s.jsxs("div",{className:"relative",children:[s.jsx(T,{classes:"absolute top-[10px] right-[10px] z-[100] flex justify-center items-center w-[35px] h-[35px] text-gray-400",event:U,children:L?s.jsx(Q,{size:"small "}):s.jsx(I,{className:" w-[20px] h-[20px]"})}),s.jsx("textarea",{className:"dark:bg-gray-800 bg-gray-300 flex-1 w-full rounded-md outline-none border-none focus:outline-none focus:border-none ring-0 focus:ring-0 dark:text-gray-300 text-gray-700 resize-none min-h-[80px] max-h-[150px] ",ref:A,name:"message",value:i.body,placeholder:"What On You Mind",onChange:t=>{P(u=>({...u,body:t.target.value}))}})]}),s.jsx(Z,{post:i,attachmentsErrors:_,onDelete:R,setImage:j,setShowImage:x,setShowPost:W,setImageIndex:N})]}),s.jsxs("div",{className:"mt-4 gap-2 flex justify-end items-center",children:[s.jsxs(z,{classes:"relative py-1.5 px-3",enabled:!0,children:["Add Files",s.jsx("input",{type:"file",name:"files",className:"absolute top-0 left-0 right-0 bottom-0 cursor-pointer opacity-0",multiple:!0,onChange:t=>{O(t)}})]}),s.jsx(T,{classes:"py-1.5 px-3",event:()=>{D()},enabled:!0,children:"Submit"})]})]}),s.jsx(J,{show:c,user:C,post:i,attachmentsErrors:_,onDelete:R,setShow:W,setImage:j,setShowImage:x,setImageIndex:N}),s.jsx(K,{image:m,show:y,imageIndex:H,post:i,setShowImage:x,setImageIndex:N,update:!1})]})},ie=({groupId:n=null,classes:h,refetch:g})=>{const[f,m]=l.useState(!1);return s.jsxs("div",{className:`max-w-[700px] w-full bg-gray-200 dark:bg-gray-900 rounded-lg lg:px-6 px-4 flex flex-col duration-500  ${h}`,children:[s.jsx("div",{className:"w-full rounded-lg bg-gray-300 hover:bg-gray-300/80 dark:bg-gray-800/50 dark:hover:bg-gray-700/50 py-1.5 px-3 duration-200 min-h-[40px] cursor-pointer text-gray-500 dark:text-gray-400 hover:border-gray-400 dark:hover:border-gray-600 border-[1px] border-solid border-gray-300 dark:border-gray-600/50",onClick:()=>m(!0),children:"What`s On Your Mind"}),s.jsx(ee,{refetch:g,showForm:f,setShowForm:m,groupId:n})]})};export{ie as C};
